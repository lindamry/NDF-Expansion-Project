NDFCLEAN ;BIR/WRT-LOOP THRU STANDARDIZED FILES TO MAKE UNIQUE TERMS MASTERS; 12/08/05 10:28
 ;;0.0; NATIONAL DRUG FILE MANAGEMENT SYSTEM;; 30 Oct 98
 ; All Unique Terms are Masters
 K ^TMP("NDF1") D UNIQ1 ; UNIQ2,UNIQ3 K NUMB,WRT,AA,TRM
 Q
UNIQ1 F WRT=0:0 S WRT=$O(^PSNDF(50.68,WRT)) Q:'WRT  S TRM=$P(^PSNDF(50.68,WRT,0),"^") I $D(^PSNDF(50.68,WRT,"VUID")),$P(^PSNDF(50.68,WRT,"VUID"),"^",2)=0 D DUP1
 Q
DUP1 S NUMB=0 F AA=0:0 S AA=$O(^PSNDF(50.68,"B",TRM,AA)) Q:'AA  S NUMB=NUMB+1 I NUMB=1 S DATE=$P($G(^PSNDF(50.68,AA,7)),"^",3) S:'$G(DATE) DATE=DT S ^TMP("NDF1",50.68,AA)="" S DA=AA,DIE="^PSNDF(50.68,",DR="99.98////"_1 D ^DIE D STAT
 Q
STAT I DATE=DT S DA(1)=AA,DIC="^PSNDF(50.68,"_AA_",""TERMSTATUS"",",X=DT,DIC(0)="L",DLAYGO=50.6899,DIC("DR")=".02////"_1 D FILE^DICN
 I DATE'=DT S DA(1)=AA,DIC="^PSNDF(50.68,"_AA_",""TERMSTATUS"",",X=DT,DIC(0)="L",DLAYGO=50.6899,DIC("DR")=".02////"_0 D FILE^DICN
 Q
UNIQ2 K NUMB,WRT,AA,TRM
 F WRT=0:0 S WRT=$O(^PS(50.416,WRT)) Q:'WRT  S TRM=$P(^PS(50.416,WRT,0),"^") I $D(^PS(50.416,WRT,"VUID")),$P(^PS(50.416,WRT,"VUID"),"^",2)=0 D DUP2
 Q
DUP2 S NUMB=0 F AA=0:0 S AA=$O(^PS(50.416,"B",TRM,AA)) Q:'AA  S NUMB=NUMB+1 I NUMB=1 S ^TMP("NDF1",50.416,AA)="",DA=AA,DIE="^PS(50.416,",DR="99.98////"_1 D ^DIE
 Q
UNIQ3 K NUMB,WRT,AA,TRM
 F WRT=0:0 S WRT=$O(^PSNDF(50.6,WRT)) Q:'WRT  S TRM=$P(^PSNDF(50.6,WRT,0),"^") I $D(^PSNDF(50.6,WRT,"VUID")),$P(^PSNDF(50.6,WRT,"VUID"),"^",2)=0 D DUP3
 Q
DUP3 S NUMB=0 F AA=0:0 S AA=$O(^PSNDF(50.6,"B",TRM,AA)) Q:'AA  S NUMB=NUMB+1 I NUMB=1 S ^TMP("NDF1",50.6,AA)="",DA=AA,DIE="^PSNDF(50.6,",DR="99.98////"_1 D ^DIE
 Q
