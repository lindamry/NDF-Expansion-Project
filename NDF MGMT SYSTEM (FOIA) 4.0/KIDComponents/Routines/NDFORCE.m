NDFORCE ;BIR/WRT-LOOP THRU STANDARDIZED FILES TO CHECK FOR INACTIVE & RE-ACTIVATED; 12/09/05 14:56
 ;;0.0; NATIONAL DRUG FILE MANAGEMENT SYSTEM;; 30 Oct 98
 D ACT,ACT2,ACT3 K NBR,ENTRY,STAMP
 Q
 ; Loop thru each AUDIT file
ACT S NBR=$P(^NDFK(5000,1,1,50.68,0),"^",2) F  S NBR=$O(^DIA(50.68,NBR)) Q:'NBR  I $P(^(NBR,0),"^",3)=21 S ENTRY=$P(^DIA(50.68,NBR,0),"^") I $D(^PSNDF(50.68,ENTRY,0)) D CHECK
 Q
CHECK I $D(^DIA(50.68,NBR,2.1)),'$D(^DIA(50.68,NBR,3.1)) S DA(1)=ENTRY,DIC="^PSNDF(50.68,"_ENTRY_",""TERMSTATUS"",",X=DT,DIC(0)="L",DLAYGO=50.6899,DIC("DR")=".02////"_1 D FILE^DICN
 I '$D(^DIA(50.68,NBR,2.1)),$D(^DIA(50.68,NBR,3.1)) S STAMP=$P(^DIA(50.68,NBR,3.1),"^") I STAMP>3050310 D INACT
 I $D(^DIA(50.68,NBR,2.1)),$D(^DIA(50.68,NBR,3.1)) S STAMP=$P(^DIA(50.68,NBR,3.1),"^") I STAMP>3050310 D INACT
 Q
INACT S DA(1)=ENTRY,DIC="^PSNDF(50.68,"_ENTRY_",""TERMSTATUS"",",X=STAMP,DIC(0)="L",DLAYGO=50.6899,DIC("DR")=".02////"_0 D FILE^DICN
 Q
ACT2 S NBR=$P(^NDFK(5000,1,1,50.416,0),"^",2) F  S NBR=$O(^DIA(50.416,NBR)) Q:'NBR  I $P(^(NBR,0),"^",3)=3 S ENTRY=$P(^DIA(50.416,NBR,0),"^") I $D(^PS(50.416,ENTRY,0)) D CHECK2
 Q
CHECK2 I $D(^DIA(50.416,NBR,2.1)),'$D(^DIA(50.416,NBR,3.1)) S DA(1)=ENTRY,DIC="^PS(50.416,"_ENTRY_",""TERMSTATUS"",",X=DT,DIC(0)="L",DLAYGO=50.4169,DIC("DR")=".02////"_1 D FILE^DICN
 I '$D(^DIA(50.416,NBR,2.1)),$D(^DIA(50.416,NBR,3.1)) S STAMP=$P(^DIA(50.416,NBR,3.1),"^") D INACT2
 Q
INACT2 S DA(1)=ENTRY,DIC="^PS(50.416,"_ENTRY_",""TERMSTATUS"",",X=STAMP,DIC(0)="L",DLAYGO=50.4169,DIC("DR")=".02////"_0 D FILE^DICN
 Q
ACT3 S NBR=$P(^NDFK(5000,1,1,50.6,0),"^",2) F  S NBR=$O(^DIA(50.6,NBR)) Q:'NBR  I $P(^(NBR,0),"^",3)=1 S ENTRY=$P(^DIA(50.6,NBR,0),"^") I $D(^PSNDF(50.6,ENTRY,0)) D CHECK3
 Q
CHECK3 I $D(^DIA(50.6,NBR,2.1)),'$D(^DIA(50.6,NBR,3.1)) S DA(1)=ENTRY,DIC="^PSNDF(50.6,"_ENTRY_",""TERMSTATUS"",",X=DT,DIC(0)="L",DLAYGO=50.6009,DIC("DR")=".02////"_1 D FILE^DICN
 I '$D(^DIA(50.6,NBR,2.1)),$D(^DIA(50.6,NBR,3.1)) S STAMP=$P(^DIA(50.6,NBR,3.1),"^") D INACT3
 Q
INACT3 S DA(1)=ENTRY,DIC="^PSNDF(50.6,"_ENTRY_",""TERMSTATUS"",",X=STAMP,DIC(0)="L",DLAYGO=50.6009,DIC("DR")=".02////"_0 D FILE^DICN
 Q
